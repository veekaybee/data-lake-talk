<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
	<title>It Came from the Data Lake</title>
	<link href="css/reveal.css" rel="stylesheet">
	<link href="css/theme/white.css" rel="stylesheet"><!-- Theme used for syntax highlighting of code -->
	<link href="lib/css/zenburn.css" rel="stylesheet"><!-- Printing and PDF exports -->

	<script>
	           var link = document.createElement( 'link' );
	           link.rel = 'stylesheet';
	           link.type = 'text/css';
	           link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
	           document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>
</head>
<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h2>It Came from the Data Lake</h2><span style="color:blue">Hadoop Best Practices and Anti-Patterns</span>
				<center>
					<img src="img/squid.png">
				</center>
			</section>
			<section>
				<h2>About me</h2><span style="color:blue">Data Science + Engineering @ <a href="http://www.captechconsulting.com/">CapTech</a></span>
				<center>
					<br>
					<p align="center">GitHub: <a href="https://github.com/veekaybee">@veekaybee</a><br></p>
					<align left="">
						Twitter: <a href="http://twitter.com/vboykis">@vboykis</a><br>
						Website: <a href="http://www.vickiboykis.com">vickiboykis.com</a><br>
						<img align="center" src="img/stack.png">
					</align>
				</center>
			</section>
			<section>
				<h2>Agenda</h2><img src="img/octopus.png">
				<div id="contentBox" style="margin:0px auto; width:100%">
					<!-- columns divs, float left, no margin so there is no space between column, width=1/3 -->
					<div id="column1" style="float:left; width:50%;">
						<h4>Big data on a laptop</h4>
						<ul>
							<li>Do you have big data?</li>
							<li>Laptop development</li>
							<li>Do you need big data? (Sampling)</li>
							<li>Big data cons</li>
						</ul>
					</div>
					<div id="column2" style="float:left; width:50%;">
						<h4>Big data on a cluster</h4>
						<ul>
							<li>Big data pros</li>
							<li>Hadoop file formats</li>
							<li>Spark development</li>
						</ul>
					</div>
				</div>
			</section>
			<section>
				<h3>You don't always have big data</h3><img src="img/bigdata.png">
			</section>
			<section>
				<h3>Les MapReduces – Word count exercise</h3><img src="img/lesmapreduces.png"> <a href="http://www.gutenberg.org/ebooks/135">Les Miserables</a> - 655k words / 3.2 MB textfile
			</section>
			<section>
				<h3>How much data can your laptop process?</h3>
				<ul>
					<li style="list-style: none"><font size="+3"></font></li>
					<li><font size="+3"><a href="http://www.cl.cam.ac.uk/research/srg/netos/camsas/pubs/eurosys15-musketeer.pdf">Musketeer:</a> "For between 40-80% of the jobs submitted to MapReduce systems, you’d be better off just running them on a single machine.""</font></li>
					<li><font size="+3"><a href="https://databricks.com/blog/2016/05/23/apache-spark-as-a-compiler-joining-a-billion-rows-per-second-on-a-laptop.html">Databricks Tungsten:</a> "Aggregation and joins on one billion records on one machine in less than 1 second."</font></li>
					<li><font size="+3"><a href="https://aadrake.com/command-line-tools-can-be-235x-faster-than-your-hadoop-cluster.html">Command Line:</a> 1.75GB containing around 2 million chess games. "This <code>find | xargs mawk | mawk</code> pipeline gets us down to a runtime of about 12 seconds, or about 270MB/sec, which is around 235 times faster than the Hadoop implementation."</font></li>
				</ul><font size="+3"></font>
			</section>
			<section>
				<h2>Checking out the file</h2>
				<pre>
                            <code class="bash" data-trim="">
                    vboykis$ head -n 1000  lesmiserables.txt

                    On the other hand, this affair afforded great delight to Madame Magloire. "Good," said she to Mademoiselle Baptistine; "Monseigneur began with other people, but he has had to wind up with himself, after all. He has regulated all his charities. Now here are three thousand francs for us! At last!"

                    That same evening the Bishop wrote out and handed to his sister a memorandum conceived in the following terms:--
                                </code>
                                    </pre>
			</section>
			<section>
				<h3>Command line MapReduce</h3>
				<pre>
                            <code class="bash" data-trim="">
                    sed -e 's/[^[:alpha:]]/ /g' lesmiserables.txt \ # only alpha 
                                    | tr '\n' " " \ # replace lines with spaces
                                    |  tr -s " "  \ # compresses adjacent spaces
                                    | tr " " '\n' \  # spaces to linebreaks
                                    | tr 'A-Z' 'a-z' \ # removes uppercase
                                    | sort \ # sorts words alphabetically
                                    | uniq -c \ # counts unique occurrences
                                    | sort -nr \ # sorts in numeric order reverse
                                    | nl \ # line numbers
                                46  1374 marius
                                47  1366 when
                                48  1316 we
                                49  1252 their
                                50  1238 jean


                                </code>
                                    </pre><img align="middle" src="img/github.png"><a href="www.github.com">GitHub</a>
			</section>
			<section>
				<h3>Python MapReduce</h3>
				<pre>
                            <code class="python" data-trim="">
                    def map_function(words):
                        """Inserts each word into a dictionary
                        :param words: List of words
                        """
                    # Apply the logic to the raw data
                    result = {}
                    for i in words:
                        try:
                            result[i] += 1
                        except KeyError:
                            result[i] = 1
                    return result   
                                </code>
                                    </pre><img align="middle" src="img/github.png"><a href="https://github.com/veekaybee/data-lake-code/blob/master/mapreduce.py">GitHub</a>
			</section>
			<section>
				<h3>Python MapReduce: benchmarks</h3>
				<pre>
                            <code class="python" data-trim="">

                    pool= Pool(processes=5)
                    result_set = pool.map(map_function, get_filenames(), chunksize=30)

                    mbp-vboykis:data_lake vboykis$ time pypy mapreduce.py
                    ('Size of files:', 3.099123327061534, 'GB')
                    
                    real    2m49.590suser   6m16.262ssys    1m26.058s

                    mbp-vboykis:data_lake vboykis$ time pypy mapreduce.py
                    ('Size of files:', 6.195150626823306, 'GB')

                    real    4m23.917suser 12m6.691ssys  1m39.279s

                    Valjean' - 1552776
                    'out' - 1580790
                    'little' - 1682841
                    'its' - 1726863
                    'than' - 1728864
                    'like' - 1804902
                    'very' - 1806903
                    'or' - 1812906
                    'A' - 1812906
                    'Marius' - 1812906
                    'we' - 1848924
                    'did' - 1852926
                    'so' - 1860930
                    'This' - 1890945
                    'more' - 1894947
                    'into' - 1950975
                    'what' - 1968984
                    'my' - 1970985
                    'when' - 2011005
                    'would' - 2023011
                    'has' - 2081040
                    'two' - 2107053
                    'Jean' - 2273136


                                </code>
                                    </pre><img align="middle" src="img/github.png"><a href="https://github.com/veekaybee/data-lake-code/blob/master/mapreduce.py">GitHub</a>
			</section>
			<section>
				<h4>MapReduce with Spark locally: <br>less code, more overhead</h4>

				<div id="column1" style="float:left; width:50%;">
				<img src="img/threads.png"> 
				<a href="http://www.python-course.eu/threads.php"><br>
				<font size="-1">source</font></a> </div>

				<div id="column2" style="float:left; width:50%;">
				<img src="img/spark-local-architecture.png"> 
				<a href="https://jaceklaskowski.gitbooks.io/mastering-apache-spark/content/spark-local.html"><font size="-1">source</font></a></div>
				

				<pre>
                            <code class="python" data-trim=""> mbp-vboykis:data_lake vboykis$ time ./bin/spark-submit --master local[5]/ spark_wordcount.py
                            </code>
                                    </pre>
			</section>
			<section>
				<h4>MapReduce with Spark</h4>
				<pre>
                            <code class="python" data-trim=""> 
                           

                    sc = SparkContext("local", "Les Mis Word Count") 

                    logFile = "/lesmiserables*.txt"

                    wordcounts = sc.textFile(logFile).map( lambda x: x.replace(',',' ').replace('.',' ').replace('-',' ').lower()) \
                            .flatMap(lambda x: x.split()) \
                            .map(lambda x: (x, 1)) \
                            .reduceByKey(lambda x,y:x+y) \
                            .map(lambda x:(x[1],x[0])) \
                            .sortByKey(False) 
                    
                    print(wordcounts.take(10)) #print first 10 results 
                    sc.stop()
                                </code>
                                    </pre><img align="middle" src="img/github.png"><a href="https://github.com/veekaybee/data-lake-code/blob/master/spark_wordcount.py">GitHub</a>
			</section>
			<section>
				<h4>How much more accuracy can big data give?</h4>
				<div id="column1" style="float:left; width:50%;"><img align="left" src="img/margin_error.png"></div>
				<div id="column2" style="float:left; width:50%;">
					<pre><code>M.E. = 1/sqrt(n) 
                            where n = population</code></pre><font size="5"></font>
					<p align="left"><font size="5">Margin of error measures reliability of sample. If data is unbiased, difference between sample percent and true population percent will be within margin of error 95% of the time (likelihood). Margin of error does not substantially decrease at sample sizes above 1500 in the example.<a href="https://onlinecourses.science.psu.edu/stat100/node/17"><br>
				source</a></font></p><font size="5"></font>
				</div><br>
				<img align="middle" src="img/github.png"><a href="https://github.com/veekaybee/data/blob/master/samplesize.py">Sample Size on GitHub</a>
			</section>
			<section>
				
				<h4>What big data can't give you</h4><img src="img/message-in-a-bottle.png"><br>
				<ul>
					<li>Data integrity
						<ul>
							<li>(denormalized, naming conventions)</li>
						</ul>
					</li>
					<li>SQL Query analyst speed</li>
					<li>Traditional data guarantees (consistency)</li>
					<li>Not a transactional database</li>
				</ul>

			</section>
			<section>
				<h3>The cost of a system</h3><img align="left" src="img/cost.png"> In some cases, an optimized single node is better than unoptimized multiple nodes. <a href="https://pdfs.semanticscholar.org/6753/959eed800e9fad9e330daae43f81b7a48017.pdf"><br>
				Source</a>
			</section>
			<section>
				<h4>What big data can give you</h4><img src="img/whale-breathing.png">
				<ul>
					<li>Storage of unstructured data</li>
					<li>Fault tolerance/availability</li>
					<li>A centralized place across departments</li>
					<li>Extremely heavy parallelized usage</li>
					<li>Ability to programmatically work with data</li>
				</ul>
			</section>
			<section>
				<h3>Good use cases for Hadoop</h3>
				<ul>
					<li>Lots of unstructured data</li>
					<li>Lots of streaming data that needs to be stored quickly</li>
					<li>Many researchers accessing in paralell</li>
					<li>You have a team of people to work on it!</li>
				</ul>
			</section>
			<section>
				<h3>Good use cases for Hadoop</h3>
				<div id="column1" style="float:left; width:50%;">
					<img src="img/netflix-logo.png"> <font size="6"><br>
					<a href="http://techblog.netflix.com/2014/10/using-presto-in-our-big-data-platform.html">
					<ul>
						<li><font size="6">10 PB warehouse.</font></li>
						<li style="list-style: none"><br></li>
						<li>2500 queries a day.<br></li>
						<li>10 million -&gt; 80 million members<br></li>
						<li>Thousands of devices, each with their own app</li>
					</ul></a></font>
				</div>
				<div id="column1" style="float:right; width:50%;">
					<img src="img/sdsslogowhite.png"><br>
					<a href="http://www.sdss.org/">Sloan Digital Sky Survey</a> <font size="4">Most detailed three-dimensional maps of the Universe ever made, with deep multi-color images of one third of the sky <img align="left" src="img/SDSS.png"></font><br>
				</div>
			</section>
			<section>
				<h2>Hadoop Optimizations</h2>
				<ul>
					<li>File Formats</li>
					<li>Language Optimization</li>
					<li>YARN Configuration</li>
					<li>Security</li>
					<li>Naming Convetions</li>
				</ul>
			</section>
			<section>
				<h2>Hadoop File Formats</h2>
				<ul>
					<li>File Compression</li>
					<li>Avro</li>
					<li>Parquet</li>
					<li>ORC</li>
				</ul>
			</section>
			<section>
				<h3><a href="http://www.slideshare.net/databricks/spark-summit-east-2017-matei-zaharia-keynote-trends-for-big-data-and-apache-spark-in-2017">Spark Development Languages</a></h3><img src="img/spark-languages.png">
				<ul>
					<li>Java 8 - Lambda Expressions</li>
					<li>Scala - Compile Time</li>
					<li>Python - Adoption Rate</li>
				</ul>
			</section>
			<section>
				<h2>Resources</h2>
				<div>
					Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank" title="Creative Commons BY 3.0">CC 3.0 BY</a>
				</div>
			</section>
		</div>
	</div>
	<script src="lib/js/head.min.js">
	</script> 
	<script src="js/reveal.js">
	</script> 
	<script>
	           // More info https://github.com/hakimel/reveal.js#configuration
	           Reveal.initialize({
	               history: true,

	               transition: 'none',

    				slideNumber: true,

	               // More info https://github.com/hakimel/reveal.js#dependencies
	               dependencies: [
	                   { src: 'plugin/markdown/marked.js' },
	                   { src: 'plugin/markdown/markdown.js' },
	                   { src: 'plugin/notes/notes.js', async: true },
	                   { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
	               ]
	           });
	</script>
</body>
</html>